{"version":3,"sources":["meteor://ðŸ’»app/common/collections.js","meteor://ðŸ’»app/common/routes.js","meteor://ðŸ’»app/server/methods.js","meteor://ðŸ’»app/server/utils.js","meteor://ðŸ’»app/server/main.js"],"names":[],"mappings":"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","file":"/app.js","sourcesContent":["import {Mongo} from 'meteor/mongo';\n\nexport const Records = new Mongo.Collection('records');\n\nRecords.before.insert(function (userId, doc) {\n  doc.createdAt = Date.now();\n});","import { Meteor } from 'meteor/meteor';\nimport { BlazeLayout } from 'meteor/kadira:blaze-layout';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\n\nFlowRouter.route('/', {\n  name: 'Output',\n  action: (params, queryParams) => {\n    BlazeLayout.render('mainLayout', { content: 'output' });\n  }\n});\n\n","import { Meteor } from 'meteor/meteor';\nimport { Records } from '../common/collections';\n\nMeteor.methods({\n  clearRecords:()=>{\n    Records.remove({});\n  },\n  clearSingleRecord:(id)=>{\n    if(!id) return false;\n    Records.remove({_id:id});\n  }\n});","import {Records} from '../common/collections';\n\nexport var Utils = new class {\n\n  constructor() {\n\n  }\n\n  /**\n   * Logs out the request\n   * @param header\n   * @param request\n   */\n  logOutput(header, request) {\n    console.log(header[['x-forwarded-for']]);\n    console.log(request);\n  };\n\n  /**\n   * Records the contents of the request to be output client side\n   * @param request\n   * @returns {*}\n   */\n  recordRequest(header, request) {\n    let head = {\n      source: header['x-forwarded-for']\n    };\n    return Records.insert({header: head, bodyParams:request});\n  };\n\n  retrieveData(params = null){\n    let r = Records.find({}).fetch();\n    let filter = _.pluck(r, 'bodyParams');\n    return _.sortBy(filter, function(o) { return -o.score; });\n  }\n\n  getBattleScores(){\n    let r = Records.find({}).fetch();\n    let f = _.pluck(r, 'bodyParams');\n    let gr = _.groupBy(f, 'side');\n    // console.log(g);\n    return _(gr).map(function(g, key) {\n      return { type: key,\n        val: _(g).reduce(function(m,x) { return m + +x.score; }, 0) };\n    });\n  }\n\n};","import {Meteor} from 'meteor/meteor';\nimport {Restivus} from 'meteor/nimble:restivus';\nimport {Utils as u} from './utils';\n// Listen to incoming HTTP requests, can only be used on the server\nWebApp.rawConnectHandlers.use(function (req, res, next) {\n  res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n  return next();\n});\nlet Api = new Restivus();\n\nApi.addRoute('postScore', {\n\n  post: function () {\n\n    let h = this.request.headers;\n    let b = this.bodyParams;\n    if (b && _.isObject(b)) {\n      u.logOutput(b);\n      b.reflectorID = u.recordRequest(h, b);\n      return b;\n    } else {\n      return {\n        message: 'Empty request received from ' + h['x-forwarded-for']\n      }\n    }\n  }\n});\n\nApi.addRoute('getBattleScores',{authRequired: false}, {\n\n  get: function () {\n    return u.getBattleScores();\n  }\n});\n\nApi.addRoute('getLeaderBoard', {authRequired: false}, {\n\n  post: function () {\n    return u.retrieveData();\n  },\n\n  get: function () {\n    return u.retrieveData();\n  }\n\n});\n\n"]}